{
  "name": "M Rate CCA Detail",
  "expression": [
    "VAR Fact_H =",
    "    SUMMARIZE (",
    "    ",
    "       FILTER( FACT_CCA_ACTUALS,RELATED(DIM_SOURCE_CRNCY[Currency Code])=\"ARS\"),",
    "        FACT_CCA_ACTUALS[CRNCY_KEY],",
    "        DIM_DATE[Calendar Month Begin Date],",
    "        \"X\", SELECTEDMEASURE ()",
    "    )",
    "VAR Fact_M =",
    "    SUMMARIZE (",
    "        FILTER(FACT_CCA_ACTUALS,RELATED(DIM_SOURCE_CRNCY[Currency Code]) <> \"ARS\"),",
    "        FACT_CCA_ACTUALS[CRNCY_KEY],",
    "        FACT_CCA_ACTUALS[PERIOD_KEY],",
    "        \"X\", SELECTEDMEASURE ()",
    "    ) ",
    "      ",
    "    ",
    "    VAR H=",
    "     CALCULATE(",
    "        SUMX(",
    "            Fact_H,",
    "            [X]",
    "            * MINX(",
    "                FILTER(",
    "                    DIM_CRNCY_CVRSN,",
    "                    DIM_CRNCY_CVRSN[Rate Effective To Date] >= DIM_DATE[Calendar Month Begin Date]",
    "                    && DIM_CRNCY_CVRSN[Rate Effective From Date] <= DIM_DATE[Calendar Month Begin Date]",
    "                    && FACT_CCA_ACTUALS[CRNCY_KEY]= DIM_CRNCY_CVRSN[FROM_CRNCY_KEY]",
    "                    && DIM_CRNCY_CVRSN[Rate Type] = \"MovAvg\"",
    "                 ",
    "                ),",
    "                DIM_CRNCY_CVRSN[EXCHG_RATE]",
    "            )",
    "        ),",
    "        ALL(DIM_CRNCY_CVRSN[Rate Effective To Date])",
    "    )",
    "            ",
    "            ",
    "            ",
    " VAR M=",
    "  CALCULATE (",
    "            SUMX (",
    "                Fact_M,",
    "                [X]",
    "                    * MINX (",
    "                        FILTER (",
    "                            DIM_CRNCY_CVRSN,",
    "                            DIM_CRNCY_CVRSN[RATE_EFF_FROM_DTE_INT_KEY] <= FACT_CCA_ACTUALS[PERIOD_KEY]",
    "                                && DIM_CRNCY_CVRSN[RATE_EFF_TO_DTE_INT_KEY] >= FACT_CCA_ACTUALS[PERIOD_KEY]",
    "                                && FACT_CCA_ACTUALS[CRNCY_KEY] = DIM_CRNCY_CVRSN[FROM_CRNCY_KEY]",
    "                                && DIM_CRNCY_CVRSN[Rate Type] = \"M\"",
    "                        ),",
    "                        DIM_CRNCY_CVRSN[EXCHG_RATE]",
    "                    )",
    "            ),",
    "            ALL ( DIM_CRNCY_CVRSN[Rate Effective To Date] )",
    "            ",
    "            )",
    "    ",
    "    VAR R = H + M",
    "    ",
    "    ",
    "RETURN",
    "  ",
    "   R"
  ]
}